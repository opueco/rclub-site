---
title: "コラム: ドント方式の議席配分"
author: kenjisato
date: "2018-09-21 07:07:27 +0900"
slug: dhondt
categories: ["column"]
tags: ["R", "programming", "intermediate"]
---

この記事は[佐藤の個人ページに掲載していたもの](https://www.kenjisato.jp/files/pc/2016/pc16_dhondt.html) を加筆・修正したものです。

# ドント方式

比例代表制には政党が獲得した得票数に近い比率で議席数を分配するようなルールが必要である。いくつかの方式が考案されているが，日本の比例区で用いられているのはドント方式と呼ばれる方法である。

総定数5議席の比例代表選挙で，開票の結果次のような得票数になったとしよう。

-----------------------------------
           政党A   政党B    政党C
--------- ------- ------- ---------
得票数      700     400     240
-----------------------------------


ドント方式では，得票数を1, 2, 3, .... で割ってできた数字（商）を大きい順に総定数の分だけ選ぶ。上の例で「÷ 4」まで計算したものが下の表である。太字が5位までの数字で，カッコ内が順位である。


----------------------------------------------------------
  得票数   政党A            政党B             政党C
--------- --------------- --------------- ----------------
÷ 1         **700** (1)     **400** (2)       **240** (4)

÷ 2         **350** (3)       200              120

÷ 3         **233** (5)       133               80

÷ 4         175               100               60
-----------------------------------------------------------


この結果を元に，得票率と議席占有率の関係を計算すると以下の表のようになる。


```{r, include=FALSE}
avr <- round(700/1340, 3)
bvr <- round(400/1340, 3)
cvr <- round(240/1340, 3)

aor <- round(3/5, 3)
bor <- round(1/5, 3)
cor <- round(1/5, 3)
```


----------------------------------------------------------------
    ―         政党A               政党B             政党C
--------- ------------------ ------------------ ----------------
得票数         700              400                   240

得票率      `r avr`            `r bvr`               `r cvr`

議席数         3                 1                    1

占有率       `r aor`              `r bor`               `r cor` 
-----------------------------------------------------------------



# 2016年参議院選挙・比例区

投票数をデータフレームに投入する。得票数のデータは次のサイトから入手できる。 

- 朝日新聞・ANN [www.asahi.com/senkyo/...](http://www.asahi.com/senkyo/senkyo2016/kaihyo/C01.html) 
- 総務省 [www.soumu.go.jp/senkyo/...](http://www.soumu.go.jp/senkyo/senkyo_s/data/sangiin24/index.html)

オブジェクトを以下のように定義する。

- `party` は政党名を並べたベクトル。
- `nvote` は各政党の比例区の得票数である。
- `votes` はこれらをまとめたデータフレーム

```{r}
party <- c("自民", "民進", "公明", "共産", "お維新", "社民", "生活",
          "こころ", "改革", "幸福")
nvote <- c(20114788, 11750965, 7572960, 6016195, 5153584, 1536238, 1067300,
          734024, 580653, 366815)

(votes <- data.frame(party, nvote))
```

改選議席数は 48 である。これにも名前を付けておこう。

```{r}
nseat <- 48
```


## 考え方の確認

自然数で割って, その商を記録していくというのが基本的な考え方である。最終的には順位を決めることを考えると，割り算した結果はすべて同じ列に入っている方が都合がよい。したがって，データは次のような形になっていることが望ましい（数字は最初の例のもの）。


-----------------------------------------
  政党        除数             値
--------- --------------- ---------------
   A            1              700

   B            1              400

   C            1              240

   A            2              350

   B            2              200

   C            2              120
   
   A            3              233

   B            3              133

   C            3               80
-----------------------------------------------------------





なお，R では割り算の商は `%/%` を使う。

```{r, prompt=TRUE}
8 %/% 3
```



## 準備

最終的には，繰り返し構文を用いて一気に解くのだが，仕組みを理解してもらうためにワンステップずつ進んでいこう。

まず，最初のデータフレーム `votes` に `divisor` という列を追加してデータを拡張する。ステップ1という意味を込めて，名前を `dhondt1` としている。`value` の値は得票数そのものである。

```{r}
(dhondt1 <- data.frame(party, divisor = 1, value = nvote))
```

「÷2」のステップは次の様にする。 

```{r}
temp <- dhondt1
temp$divisor <- 2
temp$value <- nvote %/% 2
temp
```


次に，`dhondt1` と `temp` を行方向に結合する。これには `rbind()` という関数を使う。

```{r}
(dhondt2 <- rbind(dhondt1, temp))
```

これで望んだ形になった。÷3, ÷4 と続けていけばよい。

### 何ステップあるのか？

1ステップごとに行数を増やしていくやり方はおわかりいただけたと思う。しかし，この手続きをどこまで続ければ議席数を確定できるだろうか？


**練習問題**　議席数を確定できるまでに必要なステップ数（除数の大きさ）は議席数以下になることを説明しなさい。

<details>
<summary>解説</summary>
「÷ n」の最大値は，「÷ (n+1)」のどの値よりも必ず大きくなる。したがって，1ステップ進むごとに1議席以上が確実に埋まっていく。ステップ数が最も大きくなるのは，すべての議席を単一の政党が獲得する場合であり，このときには，議席数と同じだけのステップ（除数）が必要になる。
</details>


したがって，議席数と同じだけ割り算をしてしまえば十分である。実際にはもっと計算量を節約することもできるだろうけど, この程度の無駄は許してしまおう。


## 実装


同じような計算を繰り返し実行するときには `for` を使う。


```{r}
dhondt <- data.frame()

for (i in seq_len(nseat)){
  temp <- data.frame(party, divisor = i, value = nvote %/% i)
  dhondt <- rbind(dhondt, temp)
}
```

最初の20行は次のようになる.

```{r}
head(dhondt, 20)
```

最後の20行は次のようになっている. 

```{r}
tail(dhondt, 20)
```

この大きなデータフレームを `value` 列に関して大きい順に上位48を取り出せばよい.

```{r}
dhondt$rank <- rank(- dhondt$value)
(win <- subset(dhondt, rank <= nseat))
```

獲得議席数をカウントするには次のようにすればよい。出現頻度を計算してくれる `table()` 関数を使う。結果を `as.data.frame()` でデータフレームにして，順序を並べ替えるために `order()` を使っている。このあたりは **tidyr** と **dplyr** を使った方がわかりやすいかもしれないが，他の人のコードを読むためには知っておく必要があるので，このやり方を知っておいて損はないだろう。

```{r}
seats <- as.data.frame(table(win$party))
colnames(seats) <- c("party", "nseat")

seats <- seats[order(seats$nseat, decreasing = TRUE), ]  # コンマに注意！
rownames(seats) <- NULL

seats
```




## 得票率と占有率の関係

2つのデータフレームを結合するには `merge()` を使う。**dplyr** の `*_join()` を使うほうが便利だが，ここでも特別なパッケージを使わずにやってみよう。`merge()` は順序を変えてしまうので再びソートしている。

```{r}
result <- merge(votes, seats)
result <- result[order(result$nseat, decreasing = TRUE), ]
rownames(result) <- NULL

result
```

得票率と占有率を計算する。

```{r}
result$得票率 <- result$nvote / sum(result$nvote)
result$占有率 <- result$nseat / sum(result$nseat)
result
```


# まとめ

今回の結果は，自民・民進は得票率よりも占有率が大きく，小党には逆の傾向が見られる。1回の結果だけから一般化することは難しいが，ドント方式は[得票の大きな政党に有利に働く傾向がある](https://ja.wikipedia.org/wiki/ドント方式#大政党への偏り)ことが知られている。関心のある人は得票数を変えてシミュレーションをしてみてほしい。



# 発展課題

得票数のベクトルと，総定数を入力すると，ドント方式に基づく議席数を出力する関数 `dhondt()` を作りなさい。

この関数は，


```
v <- c(700, 400, 240) # 得票数
n <- 5 # 議席数
dhondt(v, n)
```

のように使う。上の結果は，もちろん `c(3, 1, 1)` にならなければならない。

```
all(dhondt(v, n) == c(3, 1, 1))   #=> TRUE 
```
